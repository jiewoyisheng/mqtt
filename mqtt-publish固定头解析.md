public
=


###固定报头
|bit|7-1   |3-0|
|:---|:---|:---|
|byte1|报文控制类型（3）|dup qos retain|
|-|0011|xxxx|
|byte2|剩余长度|


####重发标志
第一个字节的第三位
dup为0， 表示客户端和服务端第一次发送这个publish报文，dup如果为1表示早前报文的重新发送
客户端或服务端请求重发一个 PUBLISH 报文时， 必须将 DUP 标志设置为 1 。 对于 QoS 0 的消息， DUP 标志必须设置为 0
服务端发送 PUBLISH 报文给订阅者时， 收到（入站） 的 PUBLISH 报文的 DUP 标志的值不会被传播。 发送（出站） 的 PUBLISH 报文与收到（入站） 的 PUBLISH 报文中的 DUP 标志是独立设置的， 它的值必须
单独的根据发送（出站） 的 PUBLISH 报文是否是一个重发来确定。

####服务质量等级

|Qos|  Bit2| Bit1|描述|
|----|-----|-----|--------|
|0|0|0|最多分发一次|
|1|0|1|至少分发一次|
|2|1|0|只分发一次|
|-|1|1|保留|


- 至多一次”，消息发布完全依赖底层 TCP/IP 网络。会发生消息丢失或重复。这一级别可用于如下情况，环境传感器数据，丢失一次读记录无所谓，因为不久后还会有第二次发送。
- “至少一次”，确保消息到达，但消息重复可能会发生。
- “只有一次”，确保消息到达一次。这一级别可用于如下情况，在计费系统中，消息重复或丢失会导致不正确的结果


####保留标志
第一个字第0位

如果客户端发送给服务端的publish 报文标志设置为1，服务端必须存储这个应用消息和他的服务质量等级（Qos）,以便于他分发给未来的主题名匹配的订阅者。一个新的订阅建立，对于每个匹配的主题，如果存在最近保留的消息，他必须发送给这个订阅者。如果服务端收到一条保留（ RETAIN） 标志为 1 的 QoS 0 消息， 它必须丢弃之前为那个主题保留
的任何消息。 它应该将这个新的 QoS 0 消息当作那个主题的新保留消息，但是任何时候都可以选择丢弃它— 如果这种情况发生了， 那个主题将没有保留消息 。

服务端发送 PUBLISH 报文给客户端时，如果消息是作为客户端一个新订阅的结果发送， 它必须将报文的保
留标志设为 1 [MQTT-3.3.1-8]。当一个 PUBLISH 报文发送给客户端是因为匹配一个已建立的订阅时，服
务端必须将保留标志设为 0， 不管它收到的这个消息中保留标志的值是多少