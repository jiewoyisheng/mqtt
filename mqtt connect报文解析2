

connect控制报文格式
=

####协议级别
byte7  level(4)   0x04

3.1.1版本的协议 协议级别字段的值为0x04；如果发现协议不支持，服务器必须返回码必须为0x01，然后断开客户端的连接。


####连接标志

byte8   user name flag   password flag  will retain  will qos will flag clean session  reserved

####清理会话

位置 连接标志字节的第一位 clean session   
如果清理会话（ CleanSession） 标志被设置为 0， 服务端必须基于当前会话（使用客户端标识符识别） 的状态恢复与客户端的通信。 如果没有与这个客户端标识符关联的会话， 服务端必须创建一个新的会话。在
连接断开之后， 当连接断开后， 客户端和服务端必须保存会话信息 [MQTT-3.1.2-4]。当清理会话标志为 0的会话连接断开之后，服务端必须将之后的 QoS 1 和 QoS 2 级别的消息保存为会话状态的一部分， 如果这
些消息匹配断开连接时客户端的任何订阅 [MQTT-3.1.2-5]。 服务端也可以保存满足相同条件的 QoS 0 级别的消息。
如果清理会话（ CleanSession） 标志被设置为 1， 客户端和服务端必须丢弃之前的任何会话并开始一个新的会话。会话仅持续和网络连接同样长的时间。 与这个会话关联的状态数据不能被任何之后的会话重用


####遗嘱标志
位置： 连接标志位的第二位
遗嘱标志被设为1 ，连接请求接受 遗嘱消息必须存储在服务端直到disconnect报文时删除遗嘱消息。
遗嘱消息发布的条件， 包括但不限于：

- 服务端检测到了一个 I/O 错误或者网络故障。
-  客户端在保持连接（ Keep Alive）的时间内未能通讯。
- 客户端没有先发送 DISCONNECT 报文直接关闭了网络连接。
- 由于协议错误服务端关闭了网络连接。

如果遗嘱标志被设置为 0，网络连接断开时， 不能发送遗嘱消息

####遗嘱QoS
位置连接标志的第四位和第三位
指定发布遗嘱消息时使用的服务质量等级。
如果遗嘱标志被设置为 0， 遗嘱 QoS 也必须设置为 0(0x00)
如果遗嘱标志被设置为 1， 遗嘱 QoS 的值可以等于 0(0x00)， 1(0x01)， 2(0x02)。 它的值不能等于 3


####遗嘱保留
连接标志的第5位
如果遗嘱消息被发布时需要保留，需要指定这一位的值。
如果遗嘱标志被设置为 0， 遗嘱保留（ Will Retain） 标志也必须设置为 0 。
如果遗嘱标志被设置为 1：
 如果遗嘱保留被设置为 0， 服务端必须将遗嘱消息当作非保留消息发布 。
 如果遗嘱保留被设置为 1， 服务端必须将遗嘱消息当作保留消息发布 。